(function(){"use strict";const I=({frequencies:c,height:z=300,width:o=300,minFontSize:b=4,margin:Y=2,maxWords:k=200,relativeScaling:q=.5,randomState:y=~~(Math.random()*1e9),maxFontSize:O})=>{const A=(t,r,a,p)=>d[(r+p)*(o+1)+(t+a)]-(d[r*(o+1)+(t+a)]+d[(r+p)*(o+1)+t])+d[r*(o+1)+t]===0,B=(t,r,a,p,l)=>{const[e,f]=[a+~~(p?r:t.width*r),a+~~(p?t.width*r:r)];let[u,s]=[0,0],[x,X,C]=[0,0,0],i=[];for(u=0;u<z-f;u++)for(s=0;s<o-e;s++){if(P[u*o+(s+e-1)]){s+=e-1;continue}if(!P[u*o+s]){for(;s<o-e&&!A(s,u,e,1);){for(x=s,C=s+e,X=0;x+1<C;)X=x+C>>1,A(X,u,s+e-X,1)?C=X:x=X;s=X}A(s,u,e,f)&&i.push(u*o+s)}}return i.length?i[l%i.length]:null},T=(t,r,a,p,l)=>{let[e,f]=[0,0];for(e=a;e<a+l;e++)for(f=r;f<r+p;f++)P[e*o+f]=t[(e-a)*p*4+(f-r)*4+3]?1:0;for(e=a;e<z;e++)for(f=r;f<o;f++)d[(e+1)*(o+1)+(f+1)]=d[e*(o+1)+(f+1)]+d[(e+1)*(o+1)+f]-d[e*(o+1)+f]+P[e*o+f]};c=c.sort((t,r)=>r.freq-t.freq).slice(0,k);const _=c[0].freq,F=new OffscreenCanvas(o,1).getContext("2d");if(!F)return null;c=Array.from(c,t=>({word:t.word,freq:t.freq/_}));let n=1,v=[],M;const d=new Int32Array((z+1)*(o+1)),P=new Int32Array(z*o);if(O)n=O;else if(c.length==1)n=z;else{const t=I({frequencies:c.slice(0,2),height:z,width:o,minFontSize:b,margin:Y,maxWords:k,relativeScaling:q,randomState:y,maxFontSize:z});if(!t)return null;if(t.length>=2)n=~~(2*t[0].fontSize*t[1].fontSize/(t[0].fontSize+t[1].fontSize));else if(t.length==1)n=t[0].fontSize;else return null}M=new Array(n+1);for(let t=0;t<=n;t++)M[t]=`900 ${t}px "Pretendard"`;F.font=M[1];for(const t of c){const r=t.word,a=t.freq;if(a==0)continue;let p=null,l=null,e=Math.random()>=.9,f=!1;const u=F.measureText(r);for(;!(n<b);){const i=B(u,n,Y,e,y);if(i!=null){l={posX:i%o,posY:~~(i/o),sizeX:Y+~~(e?n:u.width*n),sizeY:Y+~~(e?u.width*n:n),spanX:i%o+Y/2,spanY:~~(i/o)+Y/2,textX:i%o+Y/2-(e?n*.055:0),textY:~~(i/o)+Y/2+(e?0:n*.055)};break}f?(n-=1,e=!1):(e=!0,f=!0)}if(n<b)break;if(!l)continue;const s=new OffscreenCanvas(l.sizeX,l.sizeY).getContext("2d");if(!s)return null;s.font=M[n];const x=Y/2-(e?n*.055:0),X=Y/2+(e?0:n*.055);e?(s.textBaseline="bottom",s.rotate(90*Math.PI/180),s.fillText(t.word,X,-x),s.rotate(-90*Math.PI/180)):(s.textBaseline="top",s.fillText(t.word,x,X)),p={word:r,freq:a,fontSize:n,position:{x:l.spanX,y:l.spanY},size:{w:l.sizeX,h:l.sizeY},orientation:e,color:~~Math.floor(Math.random()*6)},v.push(p);const C=s.getImageData(0,0,l.sizeX,l.sizeY);T(C.data,~~l.posX,~~l.posY,~~l.sizeX,~~l.sizeY)}return v};self.onmessage=c=>{if(!self.FontFace){postMessage("Your browser doesn't support the FontFace API from WebWorkers yet");return}const z=new FontFace("Pretendard","url(/fonts/Pretendard-Black.woff2) format('woff2')");self.fonts.add(z),z.load().then(()=>{if(!self.OffscreenCanvas){postMessage("Your browser doesn't support OffscreeenCanvas yet");return}const o=I({frequencies:c.data.data,height:c.data.height,width:c.data.width});postMessage(o)})}})();
