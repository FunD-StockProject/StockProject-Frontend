(function(){"use strict";const I=({frequencies:c,height:x=300,width:o=300,minFontSize:F=4,margin:z=2,maxWords:k=200,relativeScaling:d=.5,randomState:y=~~(Math.random()*1e9),maxFontSize:O})=>{const q=(e,r,a,p)=>X[(r+p)*(o+1)+(e+a)]-(X[r*(o+1)+(e+a)]+X[(r+p)*(o+1)+e])+X[r*(o+1)+e]===0,_=(e,r,a,p,l)=>{const[t,f]=[a+~~(p?r:e.width*r),a+~~(p?e.width*r:r)];let[u,s]=[0,0],[C,Y,M]=[0,0,0],i=[];for(u=0;u<x-f;u++)for(s=0;s<o-t;s++){if(b[u*o+(s+t-1)]){s+=t-1;continue}if(!b[u*o+s]){for(;s<o-t&&!q(s,u,t,1);){for(C=s,M=s+t,Y=0;C+1<M;)Y=C+M>>1,q(Y,u,s+t-Y,1)?M=Y:C=Y;s=Y}q(s,u,t,f)&&i.push(u*o+s)}}return i.length?i[l%i.length]:null},j=(e,r,a,p,l)=>{let[t,f]=[0,0];for(t=a;t<a+l;t++)for(f=r;f<r+p;f++)b[t*o+f]=e[(t-a)*p*4+(f-r)*4+3]?1:0;for(t=a;t<x;t++)for(f=r;f<o;f++)X[(t+1)*(o+1)+(f+1)]=X[t*(o+1)+(f+1)]+X[(t+1)*(o+1)+f]-X[t*(o+1)+f]+b[t*o+f]};c=c.sort((e,r)=>r.freq-e.freq).slice(0,k);const v=c[0].freq,A=new OffscreenCanvas(o,1).getContext("2d");if(!A)return null;c=Array.from(c,e=>({text:e.text,freq:e.freq/v}));let B=1,n=1,T=[],P;const X=new Int32Array((x+1)*(o+1)),b=new Int32Array(x*o);if(O)n=O;else if(c.length==1)n=x;else{const e=I({frequencies:c.slice(0,2),height:x,width:o,minFontSize:F,margin:z,maxWords:k,relativeScaling:d,randomState:y,maxFontSize:x});if(!e)return null;if(e.length>=2)n=~~(2*e[0].fontSize*e[1].fontSize/(e[0].fontSize+e[1].fontSize));else if(e.length==1)n=e[0].fontSize;else return null}P=new Array(n+1);for(let e=0;e<=n;e++)P[e]=`900 ${e}px "Pretendard"`;A.font=P[1];for(const e of c){const r=e.text,a=e.freq;if(a==0)continue;let p=null,l=null;n=~~((d*(e.freq/B)+(1-d))*n);let t=Math.random()>=.9,f=!1;const u=A.measureText(r);for(;!(n<F);){const i=_(u,n,z,t,y);if(i!=null){l={posX:i%o,posY:~~(i/o),sizeX:z+~~(t?n:u.width*n),sizeY:z+~~(t?u.width*n:n),spanX:i%o+z/2,spanY:~~(i/o)+z/2,textX:i%o+z/2-(t?n*.055:0),textY:~~(i/o)+z/2+(t?0:n*.055)};break}f?(n-=1,t=!1):(t=!0,f=!0)}if(n<F)break;if(!l)continue;const s=new OffscreenCanvas(l.sizeX,l.sizeY).getContext("2d");if(!s)return null;s.font=P[n];const C=z/2-(t?n*.055:0),Y=z/2+(t?0:n*.055);t?(s.textBaseline="bottom",s.rotate(90*Math.PI/180),s.fillText(e.text,Y,-C),s.rotate(-90*Math.PI/180)):(s.textBaseline="top",s.fillText(e.text,C,Y)),p={word:r,freq:a,fontSize:n,position:{x:l.spanX,y:l.spanY},size:{w:l.sizeX,h:l.sizeY},orientation:t,color:~~Math.floor(Math.random()*6)},T.push(p);const M=s.getImageData(0,0,l.sizeX,l.sizeY);j(M.data,~~l.posX,~~l.posY,~~l.sizeX,~~l.sizeY),B=e.freq}return T};self.onmessage=c=>{if(!self.FontFace){postMessage("Your browser doesn't support the FontFace API from WebWorkers yet");return}const x=new FontFace("Pretendard","url(/fonts/Pretendard-Black.woff) format('woff')");self.fonts.add(x),x.load().then(()=>{if(!self.OffscreenCanvas){postMessage("Your browser doesn't support OffscreeenCanvas yet");return}const o=I({frequencies:c.data.data,height:c.data.height,width:c.data.width});postMessage(o)})}})();
